1. **SÆ¡ Ä‘á»“ Architecture tá»•ng quan** (chuáº©n clean + scalable microservice)  
2. **Flow Ä‘Äƒng nháº­p chi tiáº¿t**  
3. **Folder Structure mapping tá»«ng layer rÃµ rÃ ng**

---

### 1. ğŸ§© **SÆ¡ Ä‘á»“ Architecture Tá»•ng Quan**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Entry Point              â”‚
â”‚             (index.ts)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Transport Layer             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ HTTP Server (Express / Fastify)â”‚   â”‚
â”‚   â”‚ WebSocket Server (Socket.io)   â”‚   â”‚
â”‚   â”‚ gRPC Server                    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Application Layer           â”‚
â”‚ - Command Handlers                    â”‚
â”‚ - Query Handlers                      â”‚
â”‚ - Services (application service)      â”‚
â”‚ - DTOs / Validators                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Domain Layer            â”‚
â”‚ - Entities                            â”‚
â”‚ - Value Objects                       â”‚
â”‚ - Aggregates                          â”‚
â”‚ - Domain Services                     â”‚
â”‚ - Interfaces (Repository/Service)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Infrastructure Layer          â”‚
â”‚ - Repository Implementations (Mongo)  â”‚
â”‚ - Service Implementations (Mailer)    â”‚
â”‚ - Event Bus Publisher/Subscribers     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               External                â”‚
â”‚ - Database (MongoDB, SQL)             â”‚
â”‚ - Event Bus (Kafka, RabbitMQ)         â”‚
â”‚ - 3rd-party Services (OAuth, Mail)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> âœ… Æ¯u Ä‘iá»ƒm: báº¡n tÃ¡ch biá»‡t rÃµ **lá»›p Application khÃ´ng biáº¿t gÃ¬ vá» transport**, **Domain khÃ´ng biáº¿t gÃ¬ vá» infrastructure**, dá»… maintain vÃ  scale microservice hoáº·c monolith Ä‘á»u á»•n.

---

### 2. ğŸ”‘ **Flow ÄÄƒng Nháº­p**

```
[Client] 
   â”‚ 
   â–¼ 
[HTTP POST /login] 
   â”‚ 
   â–¼ 
[Transport Layer: Controller] 
   â”‚ 
   â–¼ 
[Application Layer: Command Handler] 
   â”‚ Validate input
   â”‚ Call Domain Service: AuthService
   â”‚ 
   â–¼ 
[Domain Layer: AuthService] 
   â”‚ Check user credentials
   â”‚ Generate tokens (Access, Refresh)
   â”‚ 
   â–¼ 
[Infrastructure Layer: Repository] 
   â”‚ Load user from database
   â”‚ Save refresh token
   â”‚ 
   â–¼ 
[Event Bus] (optional) 
   â”‚ Publish "UserLoggedIn" event
   â”‚ 
   â–¼ 
[Response to Client] 
   â”‚ Send token + user info
```

---

### 3. ğŸ—‚ **Folder Structure Map Tá»«ng Layer**

```
src/
â”œâ”€â”€ index.ts                        # Entry point
â”œâ”€â”€ transport/                      # Transport Layer
â”‚   â”œâ”€â”€ http/
â”‚   â”‚   â”œâ”€â”€ server.ts
â”‚   â”‚   â”œâ”€â”€ routes.ts
â”‚   â”‚   â””â”€â”€ controllers/
â”‚   â”‚       â””â”€â”€ loginController.ts
â”‚   â””â”€â”€ websocket/                  # (Optional)
â”œâ”€â”€ application/                    # Application Layer
â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â””â”€â”€ handleLoginCommand.ts
â”‚   â”œâ”€â”€ queries/
â”‚   â””â”€â”€ services/
â”œâ”€â”€ domain/                         # Domain Layer
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â””â”€â”€ User.ts
â”‚   â”œâ”€â”€ value-objects/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ AuthService.ts
â”‚   â””â”€â”€ interfaces/
â”‚       â””â”€â”€ UserRepository.ts
â”œâ”€â”€ infrastructure/                 # Infrastructure Layer
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â””â”€â”€ MongoUserRepository.ts
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ MailService.ts
â”‚   â””â”€â”€ event-bus/
â”‚       â””â”€â”€ KafkaPublisher.ts
â””â”€â”€ shared/                         # Shared Kernel
    â”œâ”€â”€ errors/
    â””â”€â”€ utils/
```

## ğŸ–¼ï¸ **SÆ¡ Ä‘á»“ tá»•ng thá»ƒ (váº½ Ä‘áº¹p báº±ng diagram tool)**
### 1. Clean Architecture + Microservice Expandable + Event Bus

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Client (Frontend)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ HTTP / WS / gRPC
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Transport Layer (Application)    â”‚
â”‚   - HTTP Controller                           â”‚
â”‚   - WS Controller                             â”‚
â”‚   - gRPC Controller (Optional)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ Calls
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Application Layer             â”‚
â”‚   - Service / UseCase                         â”‚
â”‚   - Command / Query Handler                   â”‚
â”‚   - DTOs / Mappers                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ Interface Contract (Port)
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Domain Layer                 â”‚
â”‚   - Entity                                    â”‚
â”‚   - Aggregate Root                            â”‚
â”‚   - Repository Interface                      â”‚
â”‚   - Domain Service (pure logic)               â”‚
â”‚   - Event Domain                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ Implements
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Infrastructure Layer             â”‚
â”‚   - Repository Implementation                 â”‚
â”‚   - Database (MongoDB, SQL...)                â”‚
â”‚   - External Service (Google, Facebook API)   â”‚
â”‚   - Message Broker (Redis, RabbitMQ, Kafka)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ Event Driven
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Event Bus / MQ               â”‚
â”‚   - Publish Domain Events                     â”‚
â”‚   - Subscribe Event Listeners                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Other Microservices           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‚ï¸ **Folder structure map**

```
src
â”œâ”€â”€ application
â”‚   â”œâ”€â”€ services
â”‚   â”œâ”€â”€ use-cases
â”‚   â””â”€â”€ dto
â”œâ”€â”€ domain
â”‚   â”œâ”€â”€ entities
â”‚   â”œâ”€â”€ repositories (interface)
â”‚   â”œâ”€â”€ value-objects
â”‚   â””â”€â”€ events
â”œâ”€â”€ infrastructure
â”‚   â”œâ”€â”€ database
â”‚   â”‚   â””â”€â”€ repositories (implementation)
â”‚   â”œâ”€â”€ services (Google, Facebook, SMTP...)
â”‚   â””â”€â”€ event-bus
â”œâ”€â”€ transport
â”‚   â”œâ”€â”€ http
â”‚   â”‚   â”œâ”€â”€ controllers
â”‚   â”‚   â””â”€â”€ routes
â”‚   â””â”€â”€ ws (optional)
â”œâ”€â”€ shared
â”‚   â”œâ”€â”€ utils
â”‚   â””â”€â”€ exceptions
â”œâ”€â”€ server.ts
â””â”€â”€ index.ts (Entry point)
```

